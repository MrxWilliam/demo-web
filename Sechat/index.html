<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DIM Demo</title>

    <script src="js/3rd/crypto-js/core.js"></script>
    <script src="js/3rd/crypto-js/cipher-core.js"></script>
    <script src="js/3rd/crypto-js/aes.js"></script>
    <script src="js/3rd/crypto-js/md5.js"></script>
    <script src="js/3rd/crypto-js/sha256.js"></script>
    <script src="js/3rd/crypto-js/ripemd160.js"></script>

    <script src="js/3rd/jsencrypt.js"></script>

    <script src="js/sdk/all.js"></script>

    <script src="js/protocol/search.js"></script>
    <script src="js/cache.js"></script>
    <script src="js/ans.js"></script>
    <script src="js/facebook.js"></script>
    <script src="js/messenger.js"></script>
</head>
<body>
    <script>
        function Log() {
            var str = '';
            for (var i = 0; i < arguments.length; ++i) {
                str += arguments[i] + '';
            }
            str = str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            document.writeln('<p>' + str + '</p>');
        }

        !function (ns) {
            'use strict';

            var ID = ns.ID;
            var Envelope = ns.Envelope;
            var InstantMessage = ns.InstantMessage;
            var QueryCommand = ns.protocol.group.QueryCommand;
            var SearchCommand = ns.protocol.SearchCommand;

            var Immortals = ns.Immortals;

            var sender = Immortals.HULK;
            var receiver = Immortals.MOKI;
            var name1 = Facebook.getInstance().getNickname(sender);
            var name2 = Facebook.getInstance().getNickname(receiver);

            Log('sender: ', sender, ', nickname: ', name1);
            Log('receiver: ', receiver, ', nickname: ', name2);

            //
            //  Message
            //

            var group = new ID('Group-Naruto@7ThVZeDuQAdG3eSDF6NeFjMDPjKN5SbrnM');
            Log('group: ', group);

            var env = Envelope.newEnvelope(sender, receiver);
            Log('envelope: ', env);

            var query = new QueryCommand(group);
            Log('query group info: ', query);

            var search = new SearchCommand('moky');
            Log('search command: ', search);

            var msg = InstantMessage.newMessage(search, env);
            Log('instant msg: ', msg);

        }(DIMP);
    </script>
</body>
</html>